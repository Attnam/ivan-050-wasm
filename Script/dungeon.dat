/* 
 * NOTICE!!!
 * This file contains SPOILERS, which might ruin your IVAN experience totally.
 */

Dungeons=4;
Teams=10;

/*
 * Description of hard-coded teams:
 * 0 == PLAYER_TEAM == Player and pets
 * 1 == MONSTER_TEAM == Monsters, default relation to other teams == hostile
 * 2 == ATTNAM_TEAM == Residents of Attnam
 * 3 == FINAL_BATTLE_TEAM == Petrus's team during the Final Battle
 */

Team ATTNAM_TEAM;
{
	Relation 0, FRIEND;
	AttackEvilness=250;
}

/* Script defined teams: */

Team 4; /* Enner beasts */
{
	Relation 0, HOSTILE;
	Relation 2, HOSTILE;
	Relation 3, HOSTILE;
}

Team 5; /* Spawned hostile angels */
{
	Relation 0, HOSTILE;
	Relation 1, UNCARING;
	Relation 4, HOSTILE;
}

Team 6; /* Dungeon shopkeepers */
{
	Relation 1, UNCARING;
	Relation 4, HOSTILE;
	AttackEvilness=100;
}

Team 7; /* Ivan */
{
	Relation 4, HOSTILE;
	AttackEvilness=100;
}

Team 8; /* Residents of New Attnam */
{
	Relation 0, FRIEND;
	Relation 4, HOSTILE;
	AttackEvilness=200;
}

Team 9; /* Richel Decos and his guards */
{
	Relation 4, HOSTILE;
}

Dungeon ELPURI_CAVE;
{
	Levels=10;
	Variable XSize = 64;
	Variable YSize = 36;

	LevelDefault
	{
		FillSquare=solidterrain(GROUND),wall(EARTH);
		Size=XSize, YSize;
		Rooms=10+rand%21;
		Items=25+rand%26;
		GenerateMonsters=true;
		ReCalculate=true;
		OnGround=false;
		TeamDefault=1;
		AmbientLight=0;
		LOSModifier=16;
		IgnoreDefaultSpecialSquares = false;
		BaseDifficulty = 80;
		DifficultyDelta = 20;

		Square, Random NOT_WALKABLE|NOT_IN_ROOM;
		{
			Items == stone;
			Times = 25+rand%25;
		}

		Square, Random;
		{
			Items == mine { Team = MONSTER_TEAM; Active = true; }
			Times = rand%4;
		}

		Square, Random;
		{
			Items == beartrap { Team = MONSTER_TEAM; Active = true; }
			Times = rand%4;
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN);
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}

		RoomDefault
		{
			Pos=2+rand%(XSize-6),2+rand%(YSize-6);
			Size=4+rand%8,4+rand%8;
			AltarPossible=true;
			WallSquare=solidterrain(GROUND),wall(BRICK_OLD);
			FloorSquare=solidterrain(PARQUET),empty;
			DoorSquare=solidterrain(PARQUET),door;
			GenerateDoor=true;
			ReCalculate=true;
			DivineMaster=0;
			GenerateTunnel=true;
			GenerateLanterns=true;
			Type=normalroom;
			GenerateFountains=true;
			AllowLockedDoors=true;
			AllowBoobyTrappedDoors=true;
			Shape = RECTANGLE;
		}
	}

	Level rand%3;
	{
		LevelMessage="You hear many wolves howling. You shiver.";
		Rooms=10+rand%21;

		Room 1;
		{
			Size=7,7;
			AltarPossible=false;
			Shape = ROUND_CORNERS;

			CharacterMap
			{
				Pos=1,1;
				Size=5,5;

				Types
				{
					w=wolf;
					W=werewolfhuman { Inventory = { 2, scrollofenchantweapon, scrollofenchantarmor; } }
				}
			}
			{
				.www.
				wwwww
				wwWww
				wwwww
				.www.
			}
		}
	}

	Level 1+rand%3;
	{
		Rooms=10+rand%21;

		Room 2;
		{
			Size=5,7;
			AltarPossible=false;
			DivineMaster=mellis;
			Type=shop;
			AllowLockedDoors=false;
			AllowBoobyTrappedDoors=false;
			GenerateFountains=false;

			CharacterMap
			{
				Pos = 1, 1;
				Size = 3, 5;

				Types
				{
					g = guard(SHOP) { Team=6; }
					s = shopkeeper(ELPURI_CAVE) { Team=6; }
				}
			}
			{
				g.g
				...
				.s.
				...
				g.g
			}

			ItemMap
			{
				Pos=1,1;
				Size=3,5;

				Types
				{
					g = { 2, IRON gauntlet, IRON gauntlet; }
					b = { 2, IRON boot, IRON boot; }
					a == Random { MinPrice = 100; MaxPrice = 10000; Category = HELMET|CLOAK|BODY_ARMOR|BELT; }
					d == Random { MinPrice = 100; MaxPrice = 10000; Category = RING|AMULET; }
					w == Random { MinPrice = 100; MaxPrice = 10000; Category = WEAPON|SHIELD; }
					e == Random { MinPrice = 50; MaxPrice = 10000; Category = FOOD|POTION; }
					u == Random { MinPrice = 100; MaxPrice = 10000; Category = WAND|TOOL; }
					s == wandofstriking;
				}
			}
			{
			    .g.
			    ddb
			    e.w
			    auw
			    .s.
			}
		}
	}

	Level 4;
	{
		LevelMessage="You hear a wailing scream in the distance. An enner beast must dwell in the level!";
		Rooms=10+rand%21;

		Square, Random NOT_IN_ROOM;
		{
			Character=ennerbeast { Team=4; }
		}
	}

	Level 5;
	{
		LevelMessage="You hear someone singing loudly: \"Uncle Lenin lives in Russia...\"";
		Rooms=10+rand%21;

		Room 0; /* vault */
		{
		
			GenerateLanterns=false;
			GenerateFountains=false;
			WallSquare = solidterrain(GROUND),wall(EARTH);
			GenerateDoor = false;
			GenerateTunnel = false;
			AltarPossible = false;
			Size = 7,7;

			OTerrainMap
			{
				Pos=1,1;
				Size=5,5;
				Types
				{
					x = IRON wall(BRICK_OLD);
				}
			}
			{
				xxxxx
				x...x
				x...x
				x...x
				xxxxx
			}

			Square, Random;
			{
				Items == mine { Team = MONSTER_TEAM; Active = true; Chance = 50; }
				Times = 2;
			}

			Square, Random;
			{
				Items == beartrap { Team = MONSTER_TEAM; Active = true; Chance = 50; }
				Times = 2;
			}

			Square, Pos 3,3;
			{
				Items == itemcontainer(CHEST) 
				{
					ItemsInside = { 5,	Random { MinPrice = 1000; },
										Random { MinPrice = 1000; },
										stone { Chance = 75; },
										stone { Chance = 75; },
										stone { Chance = 75; } } 
				}
			}
		}

		Square, Random NOT_IN_ROOM;
		{
			Character=communist { Team=7; }
		}
		
	}

	Level DARK_LEVEL;
	{
		Description=DarkLevel;
		LevelMessage="You shudder as you sense a being of pure darkness nearby. Your goal is near.";
		FillSquare=solidterrain(FLOOR), IRON wall(BRICK_OLD);
		Items=0;
		IgnoreDefaultSpecialSquares = true;

		RoomDefault
		{
			AltarPossible=false;
			WallSquare=solidterrain(FLOOR), IRON wall(BRICK_OLD);
			DoorSquare=solidterrain(PARQUET), IRON door;
			GenerateLanterns=false;
		}

		Square, Random IN_ROOM;
		{
			Character=elpuri;
		}

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}
	}

	Level 5+rand%4;
	{
		Rooms=10+rand%21;

		Room 1;
		{
			Size=7,7;
			AltarPossible=false;
			Shape = ROUND_CORNERS;

			CharacterMap
			{
				Pos=1,1;
				Size=5,5;

				Types
				{
					G=golem;
				}
			}
			{
				.GGG.
				GGGGG
				GGGGG
				GGGGG
				.GGG.
			}
		}
	}

	Level 8;
	{
		IgnoreDefaultSpecialSquares = true;

		Square, Random NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}

		Room 0;
		{
			Size=7,7;
			AltarPossible=false;
			WallSquare=solidterrain(GROUND),IRON wall(BRICK_OLD);
			FloorSquare=solidterrain(PARQUET),empty;
			DoorSquare=solidterrain(PARQUET),IRON door;

			Square, Pos 3,3;
			{
				OTerrain = IRON link(STAIRS_DOWN);
			}

			Square, Pos 3,5;
			{
				EntryIndex = STAIRS_DOWN;
			}
		}

		Square, Random;
		{
			Items == pickaxe;
		}
	}

	Level OREE_LAIR;
	{
		Description=OreeLair;
		LevelMessage="\"Welcome to my lair, mortal! There's no escape now!\" Suddenly the stairs disappear.";
		FillSquare=solidterrain(FLOOR), IRON wall(BRICK_OLD);
		Rooms=1;
		GenerateMonsters=false;
		Items=0;
		ReCalculate=false;
		IgnoreDefaultSpecialSquares = true;

		Room 0;
		{
			Size=7,7;
			AltarPossible=false;
			WallSquare=solidterrain(FLOOR), IRON wall(BRICK_OLD);
			FloorSquare=solidterrain(PARQUET),empty;
			GenerateDoor=false;
			ReCalculate=false;
			DivineMaster=mortifer;
			GenerateFountains=false;

			Square, Pos 3,1;
			{
				OTerrain = IRON altar(mortifer);
			}

			Square, Pos 3,3;
			{
				EntryIndex = STAIRS_UP;
			}

			Square, Pos 3,5;
			{
				OTerrain = IRON link(STAIRS_UP);
			}

			CharacterMap
			{
				Pos=1,1;
				Size=5,5;

				Types
				{
					O=oree;
					B=darkknight(ELITE);
					G=golem(BLOOD);
				}
			}
			{
				..O..
				.BBB.
				GB.BG
				.BBB.
				..G..
			}
		}
	}
}

Dungeon ATTNAM;
{
	Levels=1;
	Variable XSize = 61;
	Variable YSize = 62;

	Level 0;
	{
		Description=Attnam;
		FillSquare=solidterrain(GRASS_TERRAIN),empty;
		Size=XSize, YSize;
		GenerateMonsters=false;
		Rooms=20 + rand % 6;
		Items=0;
		ReCalculate=false;
		OnGround=true;
		TeamDefault=2;
		AmbientLight=rgb24(115, 115, 115);
		LOSModifier=48;
		IgnoreDefaultSpecialSquares = false;

		RoomDefault
		{
			Pos=2+rand%(XSize-6),2+rand%(YSize-6);
			Size=4+rand%8,4+rand%8;
			AltarPossible=false;
			WallSquare=solidterrain(GRASS_TERRAIN),wall(BRICK_FINE);
			FloorSquare=solidterrain(PARQUET),empty;
			DoorSquare=solidterrain(PARQUET),door;
			GenerateDoor=true;
			ReCalculate=true;
			DivineMaster=0;
			GenerateTunnel=false;
			GenerateLanterns=true;
			Type=normalroom;
			GenerateFountains=false;
			AllowLockedDoors=false;
			AllowBoobyTrappedDoors=false;
			Shape = RECTANGLE;
		}

		Square, Random NOT_IN_ROOM;
		{
			OTerrain=decoration(PINE);
			Times=50;
		}

		Square, Random NOT_IN_ROOM;
		{
			OTerrain=decoration(SPRUCE);
			Times=200;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character=hunter;
			Times=10;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character=polarbear;
			Times=5;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character=farmer;
			Times=5;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character=housewife;
			Times=5;
		}

		Square, Pos 30,61;
		{
			EntryIndex = STAIRS_UP;
		}
	
		Room 0;
		{
			Pos=10,10;
			Size=41,42;
			WallSquare=solidterrain(GRASS_TERRAIN),STONE wall(BRICK_FINE);
			FloorSquare=solidterrain(GRASS_TERRAIN),empty;
			GenerateDoor=false;
			ReCalculate=false;
			DivineMaster=valpurus;
			GenerateLanterns=false;
			Type=cathedral;

			Square, Pos 19, 41;
			{
				OTerrain = empty;
			}

			Square, Pos 20, 41;
			{
				OTerrain = empty;
			}

			Square, Pos 21, 41;
			{
				OTerrain = empty;
			}

			Square, Pos 31, 41;
			{
				OTerrain = STONE wall(BRICK_PROPAGANDA);
			}

			Square, Pos 9, 41;
			{
				OTerrain = STONE wall(BRICK_PROPAGANDA);
			}
			
			GTerrainMap
			{
				Pos=4,4;
				Size=33,34;
				Types
				{
					# = MARBLE solidterrain(FLOOR);
					- = MARBLE solidterrain(FLOOR);
					~ = liquidterrain(POOL);
				}
			}
			{
				............#########............
				............#-------#............
				####......###-------###......####
				#--#......#-----------#......#--#
				#--#....###-----------###....#--#
				#--#....#---------------#....#--#
				#--###..#---------------#..###--#
				#----#..#---------------#..#----#
				#----#..#---------------#..#----#
				###--#..###-----------###..#--###
				..#--###..#-----------#..###--#..
				..#----#..#-----------#..#----#..
				..###--####-----------####--###..
				....#-----#-----------#-----#....
				....#-----#-----------#-----#....
				....####--#-----------#--####....
				.......#--#-----------#--#.......
				......###-#-----------#-###......
				..#####-#-#-----------#-#-#####..
				.##-------#-----------#-------##.
				.#---~~~#-#-----------#-#------#.
				.#---~~~#-#-----------#-#------#.
				.##--~~~#-#-----------#-#-----##.
				..##-~~~#-#-----------#-#----##..
				...##~~~#-######-######-#---##...
				....#~~~#---------------#---#....
				....#~~~#---------------#---#....
				...#######---###-###---#######...
				####---------#.....#---------####
				#--------#####.....#####--------#
				#--------#.............#--------#
				##---#####.............#####---##
				.##--#.....................#--##.
				..####.....................####..
			}

			OTerrainMap
			{
				Pos=1,1;
				Size=39,40;
				Types
				{
					# = MARBLE wall(BRICK_FINE);
					@ = MARBLE wall(BRICK_PROPAGANDA);
					T = throne;
					c = decoration(CARPET);
					A = VALPURIUM altar(valpurus);
					D = MARBLE door;
					L = MARBLE door { Parameters = LOCKED; }
					b = decoration(LINDEN);
					1 = decoration(POOL_CORNER) { VisualEffects = NONE; }
					2 = decoration(POOL_CORNER) { VisualEffects = MIRROR; }
					3 = decoration(POOL_CORNER) { VisualEffects = MIRROR | FLIP; }
					4 = decoration(POOL_CORNER) { VisualEffects = FLIP; }
					5 = decoration(POOL_BORDER) { VisualEffects = NONE; }
					6 = decoration(POOL_BORDER) { VisualEffects = ROTATE; }
					7 = decoration(POOL_BORDER) { VisualEffects = FLIP; }
					8 = decoration(POOL_BORDER) { VisualEffects = MIRROR | ROTATE; }
					s = decoration(COUCH);
					f = fountain;
					d = decoration(DOUBLE_BED);
					B = GOLD boulder; 
				}
			}
			{
				b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b.b
				.......................................
				b...b...b..b...b.b.b.b.b...b..b...b...b
				..b...b........#########........b...b..
				b....b.......bb#.......#bb.......b....b
				...####b..b..###.......###..b..b####...
				b.b#..#.b....#...........#....b.#.B#b.b
				...#..#....###...........###....#..#...
				b.b#..#b..b#.....T...T.....#b..b#..#b.b
				...#..###..#.......c.......#..###.B#...
				b.b#....#.b#.......c.......#b.#....#b.b
				...#....#..#.......c.......#..#B...#...
				b.b###..#b.###.....c.....###.b#..###b.b
				....b#..#@#.b#.....c.....#b.#@#.B#b....
				b....#....#..#.....c.....#..#..B.#....b
				..bb.###..####.....c.....####..###.bb..
				b.....b#.....#.....c.....#...B.#b.....b
				.b..b..#.....#.....c.....#.B...#..b..b.
				b..b...####..#.....c.....#..####...b..b
				b....b....#..#.....c.....#.B#....b....b
				.b.b....b###D#.....c.....#D###b....b.b.
				b...b#####.#.#.....c.....#.#.#####b.b.b
				....##.....D.#.....c.....#.D.....##....
				b..b#.s.152#.#.....c.....#.#......#b..b
				.b..#...8.6#.#.....c.....#.#..A...#..b.
				b...##..8.6#.#.....c.....#.#.....##...b
				....b##.8.6#.#...........#.#....##b....
				b.b..b##8.6#.######D######.#...##b..b.b
				.......#8.6#...............#...#.......
				b...b.b#473#...............#...#b.b...b
				.b....##@####...###D###...####@##....b.
				b..####.s.s.D...#.b.b.#...L.....####..b
				..b#.d......#####.....#####........#b..
				b..#....s.s.#b..b.....b..b#........#..b
				.b.##...#####.bb..b.b..bb.#####...##.b.
				b..b##s.#b.b......f.f......b.b#..##b..b
				....b####....b...........b....####b....
				b.b...b...b.......b.b.......b...b...b.b
				...............bb.....bb...............
				b.b.b.b.b.b.b.b..b...b..b.b.b.b.b.b.b.b
			}

			ItemMap
			{
				Pos=4,4;
				Size=33,34;
				Types
				{
					# == 0;
					a == avatarofvalpurus;
					b == banana;
					k == kiwi;
					p == pineapple;
					o == IRON meleeweapon(HALBERD);
					l == MITHRIL MITHRIL meleeweapon(LONG_SWORD);
					t == IRON IRON meleeweapon(TWO_HANDED_SWORD);
					m == IRON meleeweapon(MACE);
					s == IRON meleeweapon(SPEAR);
					c == bodyarmor(CHAIN_MAIL);
					e == backpack;
					g == GOLD stone;
					i == SILVER stone;
					h == SAPPHIRE stone;
					r == RUBY stone;
					d == DIAMOND stone;
					1 == lantern { SideStackIndex = UP; }
					2 == lantern { SideStackIndex = DOWN; }
					3 == lantern { SideStackIndex = RIGHT; }
					4 == lantern { SideStackIndex = LEFT; }
					C == GOLD itemcontainer(CHEST) { ItemsInside = { 5, GOLD helmet, stone, stone, stone, GOLD banana; } }
					F == ring(RING_OF_FIRE_RESISTANCE); 
					I == ring(RING_OF_INVISIBILITY);
					E == amulet(AMULET_OF_ESP);
					S == GOLD GOLD meleeweapon(LONG_SWORD);
					U == DIAMOND helmet(HELM_OF_UNDERSTANDING);
					A == GOLD helmet(HELM_OF_ATTRACTIVITY);
					L == oillamp;
					P == GOLD bodyarmor(PLATE_MAIL);
					O == GOLD cloak;
					W == wandofpolymorph;
				}
			}
			{
				............##2###2##............
				............#.......#............
				####......###.......###......####
				#..#......#...........#......#r.#
				#..#....###...........###....#gi#
				#..#....#...d.....a.d...#....#hC#
				#..###..#......p.p......#..###I.#
				#...e#..#......b.b......#..#EOLF#
				#...e#..#......k.k......#..#.dPS#
				##1.e#..##1.r..p.p..r.1##..#Ug1##
				..#.e4##..#....b.b....#..##3r.#..
				..#....#..#....k.k....#..#Wh.L#..
				..###..4###....p.p....###3Fi###..
				....#.....3.h..b.b..h.4P.A.I#....
				....#.....#....k.k....#r.gEd#....
				....###3..#....p.p....#Sd4###....
				.......#..#....b.b....#h.#.......
				......###.3.i..k.k..i.4.###......
				..#####.#.#....p.p....#.#.#####..
				.##.......#....b.b....#.......##.
				.#......3.#....k.k....#.4......#.
				.#......#.3.g..p.p..g.4.#......#.
				.##.....4.#....b.b....#.3.....##.
				..##....#.#...........#.#....##..
				...##...#.##2###.###2##.#...##...
				....#...4...............3...#....
				....#...#...............#...#....
				...###2###...##2.2##...###2###...
				####.........#.....#....ooool####
				#........#####.....#####.....ttc#
				#........#.............#ssss...c#
				##...#####.............#####mm.##
				.##..#.....................#mm##.
				..####.....................####..
			}

			CharacterMap
			{
				Pos=4,4;
				Size=33,34;
				Types
				{
					# = 0;
					P = petrus;
					g = guard(VETERAN);
					e = guard(ELITE);
					m = guard(MASTER);
					p = priest;
					d = dolphin;
					l = frog(LIGHT);
					f = frog(GREATER_LIGHT);
					s = femaleslave;
					1 = petrusswife(1);
					2 = petrusswife(2);
					3 = petrusswife(3);
					4 = petrusswife(4);
					5 = petrusswife(5);
					6 = petrusswife(6);
					k = kamikazedwarf(valpurus);
				}
			}
			{
				............#########............
				............#g.....g#............
				####......###...m...###......####
				#k.#......#g....l....g#......#..#
				#k.#....###...........###....#..#
				#k.#....#e...sPs.s.s...e#....#..#
				#k.###..#...............#..###..#
				#k...#..#..l....f....l..#..#....#
				#k...#..#e.............e#..#....#
				###..#..###...........###..#..###
				..#..###..#...........#..###..#..
				..#....#..#g.l.....l.g#..#....#..
				..###k.####...........####..###..
				....#k...k#...........#.e...#....
				....#k...k#...........#.....#....
				....####.k#g.........g#..####....
				.......#..#...........#..#.......
				......###.#...........#.###......
				..#####e#.#...........#.#.#####..
				.##.......#g.........g#.......##.
				.#......#.#...........#.#..p...#.
				.#....d.#.#...........#.#......#.
				.##...d.#.#...........#.#.....##.
				..##.d.d#.#g.........g#.#....##..
				...##.d.#.######.######.#...##...
				....#.d.#......g.g......#...#....
				....#...#...............#...#....
				...#######...###.###..g#######...
				####.3.5.....#g...g#..g......####
				#.1......#####.....#####........#
				#....4.6.#.............#........#
				##...#####.............#####...##
				.##2.#.....................#..##.
				..####.....................####..
			}
		}

		Room 1;
		{
			Pos=32,54;
			Size=7,5;
			WallSquare=solidterrain(GRASS_TERRAIN),wall(BRICK_FINE);
			FloorSquare=solidterrain(PARQUET),empty;
			GenerateDoor=false;
			ReCalculate=false;
			DivineMaster=mellis;
			Type=shop;
			
			Square, Pos 3, 4;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = door;
			}

			Square, Pos 1, 1;
			{
				Character = slave;
			}

			Square, Pos 5, 1;
			{
				Character = shopkeeper(ATTNAM);
			}

			ItemMap
			{
				Pos=1,1;
				Size=5,3;
				Types
				{
					a == Random { MinPrice = 50; MaxPrice = 2000; Category = HELMET|CLOAK|BODY_ARMOR|BELT; }
					d == Random { MinPrice = 50; MaxPrice = 2000; Category = RING|AMULET; }
					w == Random { MinPrice = 50; MaxPrice = 2000; Category = WEAPON|SHIELD; }
					e == Random { MinPrice = 10; MaxPrice = 2000; Category = FOOD|POTION; }
					u == Random { MinPrice = 50; MaxPrice = 2000; Category = WAND|TOOL; }
					f == WOLF_FLESH lump;
					i == can { ContainedMaterial = POLAR_BEAR_FLESH; }
					l == lantern;
				}
			}
			{
			    .aaa.
			    edwww
			    efilu
			}
		}

		Room 2;
		{
			Pos=54,55;
			Size=5,5;
			WallSquare=solidterrain(GRASS_TERRAIN),STEEL wall(BRICK_FINE);
			GenerateDoor=false;
			DivineMaster=legifer;
			Type=temple;

			Square, Pos 2, 0;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = STEEL door;
			}

			Square, Pos 2, 2;
			{
				OTerrain = STEEL altar(legifer);
			}

			Square, Pos 2, 3;
			{
				Character = priest;
			}
		}

		Room 3;
		{
			Pos=2,55;
			Size=5,5;
			WallSquare=solidterrain(GRASS_TERRAIN),MARBLE wall(BRICK_FINE);
			GenerateDoor=false;
			DivineMaster=dulcis;
			Type=temple;

			Square, Pos 4, 2;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = MARBLE door;
			}

			Square, Pos 2, 2;
			{
				OTerrain = MARBLE altar(dulcis);
			}

			Square, Pos 1, 2;
			{
				Character = priest;
			}
		}

		Room 4;
		{
			Pos=54,2;
			Size=5,5;
			WallSquare=solidterrain(GRASS_TERRAIN),WOOD wall(BRICK_FINE);
			GenerateDoor=false;
			DivineMaster=seges;
			Type=temple;

			Square, Pos 0, 2;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = WOOD door;
			}

			Square, Pos 2, 2;
			{
				OTerrain = WOOD altar(seges);
			}

			Square, Pos 3, 2;
			{
				Character = priest;
			}
		}

		Room 5;
		{
			Pos=2,2;
			Size=5,5;
			WallSquare=solidterrain(GRASS_TERRAIN),PARCHMENT wall(BRICK_FINE);
			GenerateDoor=false;
			DivineMaster=sophos;
			Type=temple;

			Square, Pos 2, 4;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = PARCHMENT door;
			}

			Square, Pos 2, 2;
			{
				OTerrain = PARCHMENT altar(sophos);
			}

			Square, Pos 2, 1;
			{
				Character = priest;
			}
		}

		Room 6;
		{
			Pos=22,54;
			Size=7,5;
			WallSquare=solidterrain(GRASS_TERRAIN),wall(BRICK_FINE);
			FloorSquare=solidterrain(PARQUET),empty;
			GenerateDoor=false;
			ReCalculate=false;
			DivineMaster=sophos;
			Type=library;
			
			Square, Pos 3, 4;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = door;
			}


			Square, Pos 3, 2;
			{
				Character = librarian;
			}

			ItemMap
			{
				Pos=1,1;
				Size=5,3;

				Types
				{
					r == Random { MaxPrice = 500; Category = SCROLL|BOOK; }
				}
			}
			{
			    rrrrr
			    r...r
			    r...r
			}

			OTerrainMap
			{
				Pos=1,1;
				Size=5,3;
				Types
				{
					= = olterraincontainer(BOOK_CASE);
				}
			}
			{
				=====
				=...=
				=...=
			}
		}

		Room 7;
		{
			Pos=2,47;
			Size=7,5;
			AltarPossible=false;
			WallSquare=solidterrain(GRASS_TERRAIN),wall(BRICK_FINE);
			FloorSquare=solidterrain(PARQUET),empty;
			GenerateDoor=false;
			ReCalculate=false;
			DivineMaster=loricatus;

			Square, Pos 3, 4;
			{
				GTerrain = solidterrain(PARQUET);
				OTerrain = door;
			}


			Square, Pos 3, 2;
			{
				Character = smith;
			}
		}
		Room 8;
		{
			FloorSquare=solidterrain(FLOOR),empty;
			WallSquare=solidterrain(GRASS_TERRAIN), WOOD wall(BRICK_FINE);
			DoorSquare=solidterrain(FLOOR), door;
		}

		Room 9;
		{
			FloorSquare=solidterrain(FLOOR),empty;
			WallSquare=solidterrain(GRASS_TERRAIN), WOOD wall(BRICK_FINE);
			DoorSquare=solidterrain(FLOOR), door;
		}

		Room 10;
		{
			FloorSquare=solidterrain(FLOOR),empty;
			WallSquare=solidterrain(GRASS_TERRAIN), WOOD wall(BRICK_FINE);
			DoorSquare=solidterrain(FLOOR), door;
		}

	}
}

Dungeon NEW_ATTNAM;
{
	Levels = 1;
	Variable XSize = 50;
	Variable YSize = 50;

	Level 0;
	{
		Description="New Attnam";
		FillSquare=solidterrain(GRASS_TERRAIN),empty;
		Size=XSize, YSize;
		GenerateMonsters=false;
		Rooms= 5 + rand % 3;
		Items=0;
		ReCalculate=false;
		OnGround=true;
		TeamDefault=8;
		AmbientLight=rgb24(130, 130, 130);
		LOSModifier=48;
		IgnoreDefaultSpecialSquares = false;

		RoomDefault
		{
			Pos=2+rand%(XSize-6),2+rand%(YSize-6);
			Size=4+rand%3,4+rand%3;
			AltarPossible=false;
			WallSquare=solidterrain(GRASS_TERRAIN),WOOD wall(BRICK_FINE);
			FloorSquare=solidterrain(FLOOR),empty;
			DoorSquare=solidterrain(FLOOR), door;
			GenerateDoor=true;
			ReCalculate=true;
			DivineMaster=0;
			GenerateTunnel=false;
			GenerateLanterns=false;
			Type=normalroom;
			GenerateFountains=false;
			AllowLockedDoors=false;
			AllowBoobyTrappedDoors=false;
			Shape = ROUND_CORNERS;
		}

		Room 0;
		{
			Pos=2,2;
			Size=17,16;
			WallSquare=solidterrain(FLOOR),STONE wall(BRICK_FINE);
			FloorSquare=solidterrain(FLOOR),empty;
			GenerateDoor = false;
			ReCalculate=false;
			DivineMaster=silva;
			GenerateLanterns=false;
			OTerrainMap
			{
				Pos=2,2;
				Size=13,12;
				Types
				{
					# = GOLD wall(BRICK_FINE);
				}
			}
			{
				.............
				.............
				..#########..
				..#.......#..
				..#.......#..
				..#.......#..
				..#.......#..
				..#.......#..
				..#.......#..
				..####.####..
				.............
				.............
			}
			CharacterMap
			{
				Pos=2,2;
				Size=13,12;
				Types
				{
					# = 0;
					I = imperialist { Team = 9; }
				}
			}
			{
				.............
				.............
				..#########..
				..#.......#..
				..#.......#..
				..#...I...#..
				..#.......#..
				..#.......#..
				..#.......#..
				..#########..
				.............
				.............
			}
			GTerrainMap
			{
				Pos=2,2;
				Size=13,12;
				Types
				{
					# = 0;
					_ = GOLD solidterrain(FLOOR);
				}
			}
			{
				.............
				.............
				..#########..
				..#_______#..
				..#_______#..
				..#_______#..
				..#_______#..
				..#_______#..
				..#_______#..
				..####_####..
				.............
				.............
			}
		}

		Square, Pos 10, 17;
		{
			OTerrain = GOLD door;
		}

		Square, Random NOT_IN_ROOM;
		{
			EntryIndex = STAIRS_UP;
		}

		Square, Random NOT_IN_ROOM;
		{
			OTerrain=boulder;
			Times=50;
		}

		Square, Random NOT_IN_ROOM;
		{
			OTerrain=decoration(PALM);
			Times = 100;
		}

		Square, Random NOT_IN_ROOM;
		{
			Character=bananagrower;
			Times=40;
		}

		Square, Pos 9, 18;
		{
			OTerrain = sign { Text = "The mansion of Viceroy Richel Decos, formerly a temple of nature."; }
		}
	}
}

Dungeon UNDER_WATER_TUNNEL;
{
	Levels=3;
	Variable XSize = 80;
	Variable YSize = 20;

	LevelDefault
	{
		FillSquare=solidterrain(GROUND),wall(EARTH);
		Size=XSize, YSize;
		Rooms=5+rand%6;
		Items=15+rand%16;
		GenerateMonsters=true;
		ReCalculate=true;
		OnGround=false;
		TeamDefault=1;
		AmbientLight=0;
		LOSModifier=16;
		IgnoreDefaultSpecialSquares = false;
		BaseDifficulty = 20;
		DifficultyDelta = 20;

		Square, Random;
		{
			Items == beartrap { Team = MONSTER_TEAM; Active = true; }
			Times = rand%2;
		}

		RoomDefault
		{
			Pos=2+rand%(XSize-6),2+rand%(YSize-6);
			Size=4+rand%8,4+rand%8;
			AltarPossible=true;
			WallSquare=solidterrain(GROUND),wall(BRICK_OLD);
			FloorSquare=solidterrain(PARQUET),empty;
			DoorSquare=solidterrain(PARQUET),door;
			GenerateDoor=true;
			ReCalculate=true;
			DivineMaster=0;
			GenerateTunnel=true;
			GenerateLanterns=true;
			Type=normalroom;
			GenerateFountains=true;
			AllowLockedDoors=true;
			AllowBoobyTrappedDoors=true;
			Shape = RECTANGLE;
		}
	}

	Level 0;
	{
		IgnoreDefaultSpecialSquares = true;

		RoomDefault
		{
			AltarPossible=false;
			AllowLockedDoors=false;
			AllowBoobyTrappedDoors=false;
		}

		Square, Random;
		{
			Character=spider;
			Times=5;
		}

		Square, Random;
		{
			Character=kobold;
			Times=5;
		}

		Square, Random;
		{
			Character=zombie;
			Times=5;
		}

		Square, BoundedRandom 61, 1, 78, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN);
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}

		Room 0;
		{
			Pos=2+rand%(XSize/2-6),2+rand%(YSize-6);
			Size=5,5;
			AllowLockedDoors=false;
			AllowBoobyTrappedDoors=false;
			Shape = ROUND_CORNERS;

			Square, Pos 2,2;
			{
				OTerrain = link(STAIRS_UP);
				EntryIndex = STAIRS_UP;
			}

			Square, Pos 2,1;
			{
				Items==lantern;
			}
		}
	}

	Level 1;
	{
		Square, BoundedRandom 1, 1, 18, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP);
			EntryIndex = STAIRS_UP;
			AttachRequired = true;
		}

		Square, BoundedRandom 61, 1, 78, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_UP) { AttachedArea = 2; }
			EntryIndex = STAIRS_UP + 1;
			AttachRequired = true;
		}
	}

	Level 2;
	{
		LevelMessage="This level seems to be somehow alive...";

		Square, BoundedRandom 1, 1, 18, 18, NOT_WALKABLE|ATTACHABLE;
		{
			OTerrain = link(STAIRS_DOWN) { AttachedArea = 1; AttachedEntry = STAIRS_UP + 1; }
			EntryIndex = STAIRS_DOWN;
			AttachRequired = true;
		}

		Room 0;
		{
			Size=5,5;
			Pos=XSize/2 + rand%(XSize/2-10),2+rand%(YSize-6);
			FloorSquare=solidterrain(GRASS_TERRAIN),empty;
			GenerateFountains = false;
			AltarPossible = false;

			Square, Pos 2,2;
			{
				OTerrain = link(STAIRS_UP) { AttachedArea = WORLD_MAP; AttachedEntry = UNDER_WATER_TUNNEL_EXIT; }
				EntryIndex = STAIRS_UP;				
			}

			CharacterMap
			{
				Size = 3,3;
				Pos = 1,1;
				Types
				{
					c = carnivorousplant(GREATER);
					g = genetrixvesana;
				}
			}
			{
				ccc
				cgc
				ccc
			}
		}
	}
}
